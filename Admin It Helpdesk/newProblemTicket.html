<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>New Problem Ticket - IT-HelpDesk</title>
    <link rel="stylesheet" href="styles.css" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Poppins:wght@200;300;400;500;600;700&display=swap");
      @import url("https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.3/font/bootstrap-icons.css");
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Poppins", sans-serif;
      }
      .logo {
        margin-left: 1px !important;
      }
      .sidebar {
        height: 100vh;
      }
      .main-content {
        height: 100vh;
        overflow-y: auto;
      }

      /* Device Details Styles */
      .details-toggle-container {
        display: flex;
        align-items: center;
        margin-bottom: 10px;
      }

      .details-toggle-container label {
        margin-left: 10px;
        margin-bottom: 0;
        font-weight: 500;
      }

      #details-fields {
        display: none;
        padding-top: 5px;
      }

      #details-checkbox {
        width: 18px;
        height: 18px;
      }

      [contenteditable="true"]:empty:before {
        content: attr(data-placeholder);
        color: #6c757d;
        font-style: italic;
      }

      /* Remove any unwanted borders from dropdown menus */
      .sidebar .nav-item.dropdown .submenu-sidebar,
      .sidebar .submenu-sidebar li,
      .sidebar .submenu-sidebar li a,
      .sidebar .dropdown-submenu .sub-submenu {
        border: none !important;
        border-left: none !important;
        border-right: none !important;
        border-top: none !important;
        border-bottom: none !important;
      }

      /* Remove horizontal lines above Admin Menu and Statistic */
      .sidebar .nav-item:nth-child(4),
      .sidebar .nav-item:nth-child(5) {
        border-top: none !important;
        box-shadow: none !important;
        background-image: none !important;
      }

      .sidebar .nav-item:nth-child(4)::before,
      .sidebar .nav-item:nth-child(5)::before,
      .sidebar .nav-item:nth-child(4)::after,
      .sidebar .nav-item:nth-child(5)::after {
        display: none !important;
        border: none !important;
        background: none !important;
      }

      /* Remove any potential dividers */
      .sidebar hr,
      .sidebar .divider {
        display: none !important;
      }
    </style>
  </head>
  <body>
    <!-- Header container -->
    <div id="header-container"></div>

    <!-- Sidebar container -->
    <div id="sidebar-container"></div>

    <!-- Main Content -->
    <div class="main-content">
      <h2 class="mb-4">New Problem Ticket</h2>

      <!-- Problem Ticket Form -->
      <div class="bg-white p-4 rounded shadow-sm">
        <form id="problem-ticket-form" novalidate>
          <!-- Username Field -->
          <div class="mb-3">
            <label for="username" class="form-label">Username</label>
            <input
              type="text"
              class="form-control"
              id="username"
              placeholder="Enter username"
              required
            />
          </div>

          <!-- No. Ext / No. Telp / CUG Field -->
          <div class="mb-3">
            <label for="contact-number" class="form-label"
              >No. Ext / No. Telp / CUG*</label
            >
            <input
              type="number"
              class="form-control"
              id="contact-number"
              placeholder="Enter number"
              required
            />
          </div>

          <!-- Date Field -->
          <div class="mb-3">
            <label for="date" class="form-label">Date*</label>
            <input
              type="text"
              class="form-control"
              id="date"
              readonly
              value=""
            />
          </div>

          <!-- IP User and IP Address Fields -->
          <div class="row mb-3">
            <div class="col-md-6">
              <label for="ip-user" class="form-label">IP User</label>
              <input
                type="text"
                class="form-control"
                id="ip-user"
                placeholder="Enter number"
                required
              />
            </div>
            <div class="col-md-6">
              <label for="ip-address" class="form-label">IP Address</label>
              <input
                type="text"
                class="form-control"
                id="ip-address"
                placeholder="Autofill"
                readonly
                value=""
              />
            </div>
          </div>

          <!-- Department Field -->
          <div class="mb-3">
            <label for="department" class="form-label">Department</label>
            <select class="form-select" id="department" required>
              <option value="" selected>Select Department</option>
              <option value="option1">Department option 1</option>
              <option value="option2">Department option 2</option>
              <option value="option3">Department option</option>
            </select>
          </div>

          <!-- Category Field -->
          <div class="mb-3">
            <label for="category" class="form-label">Category</label>
            <select class="form-select" id="category" required>
              <option value="" selected>Select Department</option>
              <option value="option1">Department option</option>
              <option value="option2">Department option 1</option>
              <option value="option3">Department option 2</option>
            </select>
          </div>

          <!-- Device Details Section -->
          <div class="mb-3">
            <div class="details-toggle-container">
              <input
                class="form-check-input"
                type="checkbox"
                id="includeDeviceDetails"
              />
              <label class="form-check-label" for="includeDeviceDetails">
                Device Details(Optional)
              </label>
            </div>

            <div id="details-fields">
              <div class="row">
                <div class="col-md-6 mb-2">
                  <label for="device-type" class="form-label"
                    >Device Type</label
                  >
                  <select class="form-select" id="device-type">
                    <option value="" selected>Select Device Type</option>
                    <option value="desktop">Desktop</option>
                    <option value="laptop">Laptop</option>
                    <option value="tablet">Tablet</option>
                    <option value="mobile">Mobile Phone</option>
                    <option value="printer">Printer</option>
                    <option value="server">Server</option>
                    <option value="network">Network Equipment</option>
                    <option value="other">Other</option>
                  </select>
                </div>
                <div class="col-md-6 mb-2">
                  <label for="device-brand" class="form-label">Brand</label>
                  <input
                    type="text"
                    class="form-control"
                    id="device-brand"
                    placeholder="Enter device brand"
                  />
                </div>
              </div>
              <div class="row">
                <div class="col-md-6 mb-2">
                  <label for="device-model" class="form-label">Model</label>
                  <input
                    type="text"
                    class="form-control"
                    id="device-model"
                    placeholder="Enter device model"
                  />
                </div>
                <div class="col-md-6 mb-2">
                  <label for="device-id" class="form-label"
                    >Device ID/Serial Number</label
                  >
                  <input
                    type="text"
                    class="form-control"
                    id="device-id"
                    placeholder="Enter device ID or serial number"
                  />
                </div>
              </div>
            </div>
          </div>

          <!-- Subject Field -->
          <div class="mb-3">
            <label for="subject" class="form-label">Subject*</label>
            <input
              type="text"
              class="form-control"
              id="subject"
              placeholder="Enter Subject"
              required
            />
          </div>

          <!-- Description Field -->
          <div class="mb-3">
            <label for="description" class="form-label">Description</label>
            <div class="border rounded p-2">
              <div class="btn-toolbar mb-2" role="toolbar">
                <div class="btn-group me-2" role="group">
                  <button
                    type="button"
                    class="btn btn-sm btn-outline-secondary"
                  >
                    <i class="fas fa-undo"></i>
                  </button>
                  <button
                    type="button"
                    class="btn btn-sm btn-outline-secondary"
                  >
                    <i class="fas fa-redo"></i>
                  </button>
                </div>
                <div class="btn-group me-2" role="group">
                  <button
                    type="button"
                    class="btn btn-sm btn-outline-secondary"
                  >
                    Normal text
                  </button>
                </div>
                <div class="btn-group me-2" role="group">
                  <button
                    type="button"
                    class="btn btn-sm btn-outline-secondary"
                  >
                    <i class="fas fa-list"></i>
                  </button>
                </div>
                <div class="btn-group" role="group">
                  <button
                    type="button"
                    class="btn btn-sm btn-outline-secondary"
                  >
                    <i class="fas fa-bold"></i>
                  </button>
                  <button
                    type="button"
                    class="btn btn-sm btn-outline-secondary"
                  >
                    <i class="fas fa-italic"></i>
                  </button>
                  <button
                    type="button"
                    class="btn btn-sm btn-outline-secondary"
                  >
                    <i class="fas fa-underline"></i>
                  </button>
                  <button
                    type="button"
                    class="btn btn-sm btn-outline-secondary"
                  >
                    <i class="fas fa-strikethrough"></i>
                  </button>
                  <button
                    type="button"
                    class="btn btn-sm btn-outline-secondary"
                  >
                    <i class="fas fa-link"></i>
                  </button>
                  <button
                    type="button"
                    class="btn btn-sm btn-outline-secondary"
                  >
                    <i class="fas fa-list-ol"></i>
                  </button>
                  <button
                    type="button"
                    class="btn btn-sm btn-outline-secondary"
                  >
                    <i class="fas fa-list-ul"></i>
                  </button>
                  <button
                    type="button"
                    class="btn btn-sm btn-outline-secondary"
                  >
                    <i class="fas fa-image"></i>
                  </button>
                  <button
                    type="button"
                    class="btn btn-sm btn-outline-secondary"
                  >
                    <i class="fas fa-code"></i>
                  </button>
                  <button
                    type="button"
                    class="btn btn-sm btn-outline-secondary"
                  >
                    <i class="fas fa-minus"></i>
                  </button>
                </div>
              </div>

              <div
                contenteditable="true"
                class="form-control"
                style="min-height: 200px"
                id="description"
                data-placeholder="Deskripsikan Masalahmu!"
                required
              ></div>
            </div>
          </div>

          <!-- Attachments -->
          <div class="mb-3">
            <div class="d-flex align-items-center mb-2">
              <label class="form-label mb-0 me-3">Attachment 1</label>
              <div class="input-group" style="max-width: 300px">
                <button class="btn btn-secondary" type="button">
                  Choose File
                </button>
                <span class="form-control bg-light">No File Chosen</span>
              </div>
              <small class="ms-3 text-muted">jpeg, maks. 1 mb</small>
            </div>

            <div class="d-flex align-items-center mb-2">
              <label class="form-label mb-0 me-3">Attachment 2</label>
              <div class="input-group" style="max-width: 300px">
                <button class="btn btn-secondary" type="button">
                  Choose File
                </button>
                <span class="form-control bg-light">No File Chosen</span>
              </div>
              <small class="ms-3 text-muted">jpeg, maks. 1 mb</small>
            </div>

            <div class="d-flex align-items-center">
              <label class="form-label mb-0 me-3">Attachment 2</label>
              <div class="input-group" style="max-width: 300px">
                <button class="btn btn-secondary" type="button">
                  Choose File
                </button>
                <span class="form-control bg-light">No File Chosen</span>
              </div>
              <small class="ms-3 text-muted">jpeg, maks. 1 mb</small>
            </div>
          </div>

          <div class="mb-3">
            <small class="text-muted">*Wajib diisi</small>
            <br />
            <small class="text-muted"
              >*Mohon cek email office atau list di My Ticket(s) secara berkala
              untuk mengetahui status problem ticket anda.</small
            >
          </div>

          <!-- Form Buttons -->
          <div class="d-flex justify-content-end mt-4">
            <button
              type="submit"
              class="btn btn-warning me-2 px-4"
              id="submit-btn"
            >
              Submit
            </button>
            <button type="reset" class="btn btn-outline-secondary px-4">
              Clear
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- WhatsApp Button -->
    <a href="#" class="whatsapp-btn" title="Contact us on WhatsApp">
      <i class="fab fa-whatsapp"></i>
    </a>

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="utils.js"></script>
    <script>
      // Auto-fill the date field with current date
      document.addEventListener("DOMContentLoaded", function () {
        const today = new Date();
        const formattedDate = today.toLocaleDateString("en-GB", {
          day: "2-digit",
          month: "long",
          year: "numeric",
        });
        document.getElementById("date").value = formattedDate;

        // Sidebar Menu Toggle
        // Add click event to dropdown toggles
        const dropdownToggles = document.querySelectorAll(
          ".nav-link.dropdown-toggle"
        );

        dropdownToggles.forEach((toggle) => {
          toggle.addEventListener("click", function (e) {
            e.preventDefault();

            // Toggle the submenu visibility
            const submenu = this.nextElementSibling;
            if (submenu) {
              const isVisible = submenu.style.display === "block";
              submenu.style.display = isVisible ? "none" : "block";

              // Toggle the arrow icon rotation
              const arrow = this.querySelector(".fa-angle-down");
              if (arrow) {
                arrow.style.transform = isVisible
                  ? "rotate(0deg)"
                  : "rotate(180deg)";
              }
            }
          });
        });

        // Initialize submenus based on active state
        const activeSubmenuItems = document.querySelectorAll(
          ".submenu-sidebar li a.active"
        );
        activeSubmenuItems.forEach((item) => {
          const parentSubmenu = item.closest(".submenu-sidebar");
          if (parentSubmenu) {
            parentSubmenu.style.display = "block";

            const parentDropdown = parentSubmenu.previousElementSibling;
            if (
              parentDropdown &&
              parentDropdown.classList.contains("dropdown-toggle")
            ) {
              const arrow = parentDropdown.querySelector(".fa-angle-down");
              if (arrow) {
                arrow.style.transform = "rotate(180deg)";
              }
            }
          }
        });

        // Toggle details fields
        const detailsCheckbox = document.getElementById("includeDeviceDetails");
        const detailsFields = document.getElementById("details-fields");

        // Hide details fields initially
        detailsFields.style.display = "none";

        detailsCheckbox.addEventListener("change", function () {
          if (this.checked) {
            detailsFields.style.display = "block";
          } else {
            detailsFields.style.display = "none";
          }
        });

        // Form validation
        const form = document.getElementById("problem-ticket-form");
        const submitBtn = document.getElementById("submit-btn");

        submitBtn.addEventListener("click", function (event) {
          event.preventDefault();

          // Trigger HTML5 validation
          const isFormValid = form.checkValidity();
          if (!isFormValid) {
            // Trigger browser's built-in validation UI
            form.reportValidity();
            return;
          }

          // Get form fields
          const username = document.getElementById("username").value;
          const contactNumber = document.getElementById("contact-number").value;
          const department = document.getElementById("department").value;
          const category = document.getElementById("category").value;
          const subject = document.getElementById("subject").value;
          const description =
            document.getElementById("description").innerText ||
            document.getElementById("description").textContent;

          // Additional JavaScript validation
          if (
            !username ||
            !contactNumber ||
            !department ||
            !category ||
            !subject ||
            !description
          ) {
            Swal.fire({
              icon: "error",
              title: "Validation Error",
              text: "Please fill out all required fields",
            });
            return;
          }

          console.log("Form submitted, redirecting...");

          // Redirect to Home page with notification parameter
          window.location.href = "Home.html?showNotification=true";
        });
      });
    </script>
  </body>
</html>
