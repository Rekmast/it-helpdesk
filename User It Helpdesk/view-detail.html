<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>IT-HelpDesk - Response & Detail</title>
    <link rel="stylesheet" href="styles.css" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Odor+Mean+Chey&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <!-- Navigation Bar -->
    <div id="navbar-container"></div>

    <div class="content-container">
      <div class="detail-container">
        <div class="detail-header">
          <h1>Response & Detail</h1>
        </div>

        <div class="detail-actions">
          <a href="mytickets.html" class="back-button">
            <i class="fas fa-arrow-left me-2"></i>
            <span id="ticket-subject">Masalah Di Excel</span>
          </a>
          <button class="print-button" title="Print">
            <i class="fas fa-print"></i>
          </button>
        </div>

        <!-- Message Container -->
        <div class="message-container" id="message-container">
          <!-- Initial User Message (Description) - Always visible -->
          <div class="message user-message">
            <div class="message-bubble">
              <p id="user-description">
                akan segera di periksa lebih lanjut untuk unit laptop nya.
              </p>
              <div class="msg-time">
                <i class="far fa-clock"></i>
                <span id="description-time">6:30 pm</span>
              </div>
            </div>
            <div class="user-avatar">
              <i class="fas fa-user"></i>
            </div>
          </div>

          <!-- On Progress Messages - Only visible in On Progress status -->
          <div id="progress-messages">
            <!-- Admin Response -->
            <div class="message admin-message">
              <div class="admin-avatar">
                <i class="fas fa-headset"></i>
              </div>
              <div class="message-bubble">
                <p>
                  Terima kasih atas laporannya. Kami akan segera memeriksa
                  masalah pada laptop Anda.
                </p>
                <div class="msg-time"><i class="far fa-clock"></i> 6:32 pm</div>
              </div>
            </div>

            <!-- User Follow-up Message -->
            <div class="message user-message">
              <div class="message-bubble">
                <p>
                  dan sepertinya terdapat gangguan di aplikasi excelnya juga
                  tolong diperbaiki
                </p>
                <div class="msg-time"><i class="far fa-clock"></i> 6:34 pm</div>
              </div>
              <div class="user-avatar">
                <i class="fas fa-user"></i>
              </div>
            </div>
          </div>

          <!-- Solved Messages - Only visible in Solved status -->
          <div id="solved-messages" style="display: none">
            <!-- Admin Response -->
            <div class="message admin-message">
              <div class="admin-avatar">
                <i class="fas fa-headset"></i>
              </div>
              <div class="message-bubble">
                <p>
                  Terima kasih atas laporannya. Kami akan segera memeriksa
                  masalah pada laptop Anda.
                </p>
                <div class="msg-time"><i class="far fa-clock"></i> 6:32 pm</div>
              </div>
            </div>

            <!-- User Follow-up Message -->
            <div class="message user-message">
              <div class="message-bubble">
                <p>
                  dan sepertinya terdapat gangguan di aplikasi excelnya juga
                  tolong diperbaiki
                </p>
                <div class="msg-time"><i class="far fa-clock"></i> 6:38 pm</div>
              </div>
              <div class="user-avatar">
                <i class="fas fa-user"></i>
              </div>
            </div>

            <!-- Final Admin Solution -->
            <div class="message admin-message">
              <div class="admin-avatar">
                <i class="fas fa-headset"></i>
              </div>
              <div class="message-bubble">
                <p>
                  Baiklah sudah diperbaiki silahkan dicek kembali. Masalah pada
                  Excel dan laptop sudah teratasi.
                </p>
                <div class="msg-time"><i class="far fa-clock"></i> 6:45 pm</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Message Input - Only visible for Open and On Progress -->
        <div class="message-input" id="message-input-container">
          <input type="text" placeholder="Write message" />
          <button class="attachment-btn" style="border: none; background: none">
            <i class="fas fa-paperclip"></i>
          </button>
          <button class="attachment-btn" style="border: none; background: none">
            <i class="far fa-file"></i>
          </button>
          <button class="send-button">
            Send
            <i class="fas fa-paper-plane"></i>
          </button>
        </div>

        <!-- End Chat Message - Only visible for Solved and Expired -->
        <div
          class="text-center py-4 text-muted"
          id="chat-ended-message"
          style="display: none"
        >
          <p class="mb-0">The Chat Ends Here</p>
        </div>
      </div>

      <div class="sidebar">
        <!-- User Information Card -->
        <div class="user-info-card">
          <div class="info-section">
            <h5>User Information</h5>
            <p><strong>John Doe</strong></p>
            <p>IP Address : 172.16.75.93</p>
            <p>No Ext./ Telp./ CUG :</p>
            <p>03 Maret 2025</p>
            <p>IT Office - Aplikasi Insosys (Umum)</p>
          </div>

          <div class="info-section position-relative">
            <h5>Status</h5>
            <div id="status-badge"></div>
          </div>

          <div class="info-section">
            <h5>IT Support Information</h5>
            <p>3 Maret 2025 20:38</p>
            <p>
              handle by: <strong>John Newman</strong><br />
              <span id="admin-action"
                >showed as an Administrator to user Information Technology
                Department</span
              ><br />
              john.newman@trans7.co.id
            </p>
          </div>
        </div>
      </div>
    </div>

    <!-- WhatsApp Button -->
    <div id="whatsapp-container"></div>

    <!-- Bootstrap and jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Include components -->
    <script>
      // Function to include HTML content from another file
      function includeHTML(url, callback) {
        const xhr = new XMLHttpRequest();
        xhr.open("GET", url, true);
        xhr.onreadystatechange = function () {
          if (this.readyState === 4 && this.status === 200) {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(
              this.responseText,
              "text/html"
            );

            // Add component elements to body but hidden
            const components = htmlDoc.querySelectorAll('[id$="-component"]');
            components.forEach((component) => {
              const clone = document.importNode(component, true);
              clone.style.display = "none";
              document.body.appendChild(clone);
            });

            // Get the script part
            const script = htmlDoc.querySelector("script");
            if (script) {
              eval(script.innerHTML);
            }

            // Initialize components after loading
            if (window.ITHelpdesk && window.ITHelpdesk.includeComponent) {
              window.ITHelpdesk.includeComponent(
                "navbar-component",
                "navbar-container"
              );
              window.ITHelpdesk.includeComponent(
                "whatsapp-component",
                "whatsapp-container"
              );
              window.ITHelpdesk.setActiveNavigation();
            }

            if (callback) callback();
          }
        };
        xhr.send();
      }

      // Load components from components-user.html
      document.addEventListener("DOMContentLoaded", function () {
        includeHTML("components-user.html");

        // Parse URL parameters to get ticket details
        const urlParams = new URLSearchParams(window.location.search);
        const ticketId = urlParams.get("id");
        const ticketSubject = urlParams.get("subject");
        const ticketStatus = urlParams.get("status") || "Open"; // Default to Open if not specified
        const ticketContent = urlParams.get("content"); // Get the message content if available

        // Update page with ticket info if available
        if (ticketSubject) {
          document.getElementById("ticket-subject").textContent = ticketSubject;
        }

        // Populate the ticket description based on subject if content not provided
        const userDescription = document.getElementById("user-description");
        if (ticketContent) {
          userDescription.innerHTML = decodeURIComponent(ticketContent);
        } else {
          // Default messages based on ticket subject if content not provided
          switch (ticketSubject) {
            case "Product Activation Failed":
              userDescription.innerHTML = `Dear tim IT,<br><br>
              saya tidak bisa memakai aplikasi Ms.Word pada komputer saya. Mohon dibantu untuk aktivasi ms.office ya<br><br>
              Terima kasih.`;
              break;
            case "Permohonan penembakan PB Built in weekend project":
              userDescription.innerHTML = `Mohon untuk dilakukan penembakan pada PB Built in weekend project
              PB0123456789, agar shift editing bisa di tarik, dikarenakan
              terjadi kendala dalam pekerjaan shift editing padahal sudah
              approval dari postpro dan PCM. dengan detail PEPS sebagai berikut:<br><br>
              PEPSB0123456789 (Shift)<br>
              PEPSB0123456789 (Shift)<br><br>
              Terimakasih`;
              break;
            case "MS Excel bermasalah":
              userDescription.innerHTML = `Dear Team IT, aplikasi MS Office (Excel) saya tidak bisa
              digunakan. Setiap buka aplikasi selalu minta product key. Mohon
              bantuannya.<br><br>
              Terima kasih.`;
              break;
            case "Reset Password Wifi dan Device Wifi Login":
              userDescription.innerHTML = `Dear Tim IT,<br><br>
              Mau minta tolong utk reset password WiFi dan Devices yang sudah
              pernah login. Terima kasih`;
              break;
            default:
              userDescription.innerHTML = `Dear Tim IT,<br><br>
              Mohon bantuan untuk mengatasi masalah yang saya alami.<br><br>
              Terima kasih.`;
          }
        }

        // Update view based on status
        updateViewBasedOnStatus(ticketStatus);

        // Function to update the view based on ticket status
        function updateViewBasedOnStatus(status) {
          const statusBadge = document.getElementById("status-badge");
          const messageInputContainer = document.getElementById(
            "message-input-container"
          );
          const chatEndedMessage =
            document.getElementById("chat-ended-message");
          const progressMessages = document.getElementById("progress-messages");
          const solvedMessages = document.getElementById("solved-messages");
          const adminAction = document.getElementById("admin-action");

          // Reset all elements
          messageInputContainer.style.display = "none";
          chatEndedMessage.style.display = "none";
          progressMessages.style.display = "none";
          solvedMessages.style.display = "none";

          // Update based on status
          switch (status.toLowerCase()) {
            case "open":
              statusBadge.innerHTML =
                '<div class="status status-open">Open</div>';
              messageInputContainer.style.display = "flex";
              adminAction.textContent = "waiting to be assigned";
              break;

            case "in progress":
            case "on progress":
            case "progress":
              statusBadge.innerHTML =
                '<div class="status status-progress">On Progress By: John Newman</div>';
              messageInputContainer.style.display = "flex";
              progressMessages.style.display = "block";
              adminAction.textContent =
                "showed as an Administrator to user Information Technology Department";
              break;

            case "solved":
              statusBadge.innerHTML =
                '<div class="status status-solved">Solved By: John Newman</div>';
              chatEndedMessage.style.display = "block";
              solvedMessages.style.display = "block";
              adminAction.textContent = "closed this ticket as Solved";
              break;

            case "expired":
              statusBadge.innerHTML =
                '<div class="status status-expired">Expired</div>';
              chatEndedMessage.style.display = "block";
              progressMessages.style.display = "block";
              adminAction.textContent = "marked this ticket as Expired";
              break;

            default:
              // Default to Open
              statusBadge.innerHTML =
                '<div class="status status-open">Open</div>';
              messageInputContainer.style.display = "flex";
              adminAction.textContent = "waiting to be assigned";
          }
        }
      });
    </script>
  </body>
</html>
